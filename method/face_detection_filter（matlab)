folderPath = ''; 
images = dir(fullfile(folderPath, '*.jpg'));

% 加载人脸检测器
faceDetector = vision.CascadeObjectDetector();
faceDetector.MergeThreshold = 3;  

% 设置边界限制
boundaryLimit = 0.40;

% 遍历文件夹中的每一张图像
for i = 1:length(images)
    imagePath = fullfile(folderPath, images(i).name);
    img = imread(imagePath);
    imgSize = size(img);

    % 进行人脸检测
    bboxes = step(faceDetector, img);

    % 输出当前图像路径和检测到的人脸数量
    fprintf('%s: Detected %d faces.\n', imagePath, size(bboxes, 1));

    % 判断人脸数量和边界位置
    if size(bboxes, 1) > 1 || any(bboxes(:,1) < imgSize(2) * boundaryLimit | ...
                                   bboxes(:,2) < imgSize(1) * boundaryLimit | ...
                                   bboxes(:,1) + bboxes(:,3) > imgSize(2) * (1-boundaryLimit) | ...
                                   bboxes(:,2) + bboxes(:,4) > imgSize(1) * (1-boundaryLimit))
        delete(imagePath);
        fprintf('Removed %s (detected %d faces, possible partial faces)\n', imagePath, size(bboxes, 1));
    end
end
